{"version":3,"file":"index-node16.mjs","sources":["../src/index.ts"],"sourcesContent":["import { POB_TARGET } from 'pob-babel';\nimport formatterANSI from 'nightingale-ansi-formatter';\nimport consoleOutput from 'nightingale-console-output';\nimport { createFindDebugLevel } from 'nightingale-debug';\nimport formatterJSON from 'nightingale-json-formatter';\nimport { Level } from 'nightingale-levels';\nimport type {\n  IsHandling,\n  Handle,\n  LogRecord,\n  Metadata,\n  Handler,\n} from 'nightingale-types';\n\nconst defaultFormatter =\n  POB_TARGET === 'node' &&\n  !process.stdout.isTTY &&\n  process.env.NIGHTINGALE_CONSOLE_FORMATTER !== 'ansi'\n    ? formatterJSON\n    : formatterANSI;\n\nconst createHandle = (\n  formatter = defaultFormatter,\n  output = consoleOutput,\n): Handle => {\n  return <T extends Metadata>(record: LogRecord<T>): void => {\n    output(formatter(record), record);\n  };\n};\nconst findDebugLevel = createFindDebugLevel(process.env.DEBUG);\n\ninterface ConsoleHandlerOptions {\n  formatter?: <T extends Metadata>(record: LogRecord<T>) => string;\n  output?: <T extends Metadata>(\n    param: string | string[],\n    record: LogRecord<T>,\n  ) => void;\n  // compat with nightingale-app-console, not used yet\n  theme?: 'dark' | 'light';\n}\n\nexport class ConsoleHandler implements Handler {\n  minLevel: Level = Level.ALL;\n\n  isHandling: IsHandling;\n\n  handle: Handle;\n\n  constructor(minLevel: Level, options: ConsoleHandlerOptions = {}) {\n    this.minLevel = minLevel;\n    this.isHandling = (level: Level, key: string) =>\n      level >= findDebugLevel(minLevel, key);\n    this.handle = createHandle(options.formatter, options.output);\n  }\n}\n"],"names":["defaultFormatter","process","stdout","isTTY","env","NIGHTINGALE_CONSOLE_FORMATTER","formatterJSON","formatterANSI","createHandle","formatter","output","consoleOutput","record","findDebugLevel","createFindDebugLevel","DEBUG","ConsoleHandler","minLevel","Level","ALL","constructor","options","isHandling","level","key","handle"],"mappings":";;;;;;AAcA,MAAMA,gBAAgB,GAEpB,CAACC,OAAO,CAACC,MAAM,CAACC,KAAK,IACrBF,OAAO,CAACG,GAAG,CAACC,6BAA6B,KAAK,MAAM,GAChDC,aAAa,GACbC,aAAa,CAAA;AAEnB,MAAMC,YAAY,GAAG,CACnBC,SAAS,GAAGT,gBAAgB,EAC5BU,MAAM,GAAGC,aAAa,KACX;AACX,EAAA,OAA4BC,MAAoB,IAAW;AACzDF,IAAAA,MAAM,CAACD,SAAS,CAACG,MAAM,CAAC,EAAEA,MAAM,CAAC,CAAA;GAClC,CAAA;AACH,CAAC,CAAA;AACD,MAAMC,cAAc,GAAGC,oBAAoB,CAACb,OAAO,CAACG,GAAG,CAACW,KAAK,CAAC,CAAA;AAYvD,MAAMC,cAAc,CAAoB;EAC7CC,QAAQ,GAAUC,KAAK,CAACC,GAAG,CAAA;AAM3BC,EAAAA,WAAW,CAACH,QAAe,EAAEI,OAA8B,GAAG,EAAE,EAAE;IAChE,IAAI,CAACJ,QAAQ,GAAGA,QAAQ,CAAA;AACxB,IAAA,IAAI,CAACK,UAAU,GAAG,CAACC,KAAY,EAAEC,GAAW,KAC1CD,KAAK,IAAIV,cAAc,CAACI,QAAQ,EAAEO,GAAG,CAAC,CAAA;AACxC,IAAA,IAAI,CAACC,MAAM,GAAGjB,YAAY,CAACa,OAAO,CAACZ,SAAS,EAAEY,OAAO,CAACX,MAAM,CAAC,CAAA;AAC/D,GAAA;AACF;;;;"}