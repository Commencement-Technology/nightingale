{"version":3,"file":"index-node8-dev.cjs.js","sources":["../src/index.js"],"sourcesContent":["import { Client as RavenClient } from 'raven';\nimport levels from 'nightingale-levels';\n\nconst mapToSentryLevel = {\n  [levels.TRACE]: 'debug',\n  [levels.DEBUG]: 'debug',\n  [levels.INFO]: 'info',\n  [levels.WARNING]: 'warning',\n  [levels.ERROR]: 'error',\n  [levels.FATAL]: 'fatal',\n  [levels.EMERGENCY]: 'fatal',\n};\n\nconst createHandler = (ravenUrl, { getUser = () => {}, getTags = () => {} } = {}) => {\n  const ravenClient = new RavenClient(ravenUrl);\n\n  return record => {\n    const { key, level, metadata, extra } = record;\n    let error = metadata && metadata.error;\n\n    if (!error) {\n      return;\n    }\n\n    const extraData = { ...metadata, extra };\n    delete extraData.error;\n\n    if (error.originalError) {\n      // error-processor\n      extraData.parsedStack = error.stackTrace.toArray();\n      error = error.originalError;\n    }\n\n    ravenClient.captureException(error, {\n      logger: key,\n      level: mapToSentryLevel[level] || 'error',\n      extra: extraData,\n      user: getUser(record),\n      tags: getTags(record),\n    });\n  };\n};\n\nexport default function SentryHandler(ravenUrl: string, minLevel: number, options) {\n  this.minLevel = minLevel;\n  this.handle = createHandler(ravenUrl, options);\n}\n"],"names":["mapToSentryLevel","levels","TRACE","DEBUG","INFO","WARNING","ERROR","FATAL","EMERGENCY","createHandler","ravenUrl","getUser","getTags","ravenClient","RavenClient","record","key","level","metadata","extra","error","extraData","originalError","parsedStack","stackTrace","toArray","captureException","SentryHandler","minLevel","options","handle"],"mappings":";;;;;;;;AAGA,MAAMA,mBAAmB;GACtBC,OAAOC,KAAR,GAAgB,OADO;GAEtBD,OAAOE,KAAR,GAAgB,OAFO;GAGtBF,OAAOG,IAAR,GAAe,MAHQ;GAItBH,OAAOI,OAAR,GAAkB,SAJK;GAKtBJ,OAAOK,KAAR,GAAgB,OALO;GAMtBL,OAAOM,KAAR,GAAgB,OANO;GAOtBN,OAAOO,SAAR,GAAoB;CAPtB;;AAUA,MAAMC,gBAAgB,CAACC,QAAD,EAAW,EAAEC,UAAU,MAAM,EAAlB,EAAsBC,UAAU,MAAM,EAAtC,OAAX,KAA+D;QAC7EC,cAAc,IAAIC,YAAJ,CAAgBJ,QAAhB,CAApB;;SAEOK,UAAU;UACT,EAAEC,GAAF,EAAOC,KAAP,EAAcC,QAAd,EAAwBC,KAAxB,KAAkCJ,MAAxC;QACIK,QAAQF,YAAYA,SAASE,KAAjC;;QAEI,CAACA,KAAL,EAAY;;;;UAINC,8BAAiBH,QAAjB,IAA2BC,KAA3B,GAAN;WACOE,UAAUD,KAAjB;;QAEIA,MAAME,aAAV,EAAyB;;gBAEbC,WAAV,GAAwBH,MAAMI,UAAN,CAAiBC,OAAjB,EAAxB;cACQL,MAAME,aAAd;;;gBAGUI,gBAAZ,CAA6BN,KAA7B,EAAoC;cAC1BJ,GAD0B;aAE3BhB,iBAAiBiB,KAAjB,KAA2B,OAFA;aAG3BI,SAH2B;YAI5BV,QAAQI,MAAR,CAJ4B;YAK5BH,QAAQG,MAAR;KALR;GAjBF;CAHF;;AA8BA,AAAe,SAASY,aAAT,CAAuBjB,QAAvB,EAAyCkB,QAAzC,EAA2DC,OAA3D,EAAoE;sBAArC,UAAqC;;sBAAnB,UAAmB;;;;;OAC5ED,QAAL,GAAgBA,QAAhB;OACKE,MAAL,GAAcrB,cAAcC,QAAd,EAAwBmB,OAAxB,CAAd;;;;;"}