{"version":3,"file":"index-browsermodern.es.js","sources":["../src/debug.ts","../src/index.ts"],"sourcesContent":["export function getDebugString(): string {\n  const querystring = document.location?.search;\n  const debugFromLocalStorage =\n    (window.localStorage && localStorage.getItem('debug')) || '';\n\n  if (!querystring) {\n    return debugFromLocalStorage;\n  }\n\n  // https://developer.mozilla.org/en-US/docs/Web/API/URLUtils/search#Get_the_value_of_a_single_search_param\n  const debugFromQueryString = decodeURI(\n    querystring.replace(\n      // eslint-disable-next-line unicorn/no-unsafe-regex, prefer-regex-literals\n      new RegExp('^(?:.*[&\\\\?]DEBUG(?:\\\\=([^&]*))?)?.*$', 'i'),\n      '$1',\n    ),\n  );\n\n  return (\n    (debugFromLocalStorage ? `${debugFromLocalStorage},` : '') +\n    debugFromQueryString\n  );\n}\n","import { createBrowserConsoleFormatter } from 'nightingale-browser-console-formatter';\nimport consoleOutput from 'nightingale-console-output';\nimport { createFindDebugLevel } from 'nightingale-debug';\nimport type {\n  Level,\n  Handle,\n  IsHandling,\n  LogRecord,\n  Metadata,\n  Handler,\n} from 'nightingale-types';\nimport { getDebugString } from './debug';\n\n// debug string can change any time (localStorage), so we need a new object each time.\nconst findDebugLevel = (minLevel: Level, key: string): Level =>\n  createFindDebugLevel(getDebugString())(minLevel, key);\n\ntype Theme = 'light' | 'dark';\n\nconst getDefaultTheme = (): Theme => {\n  try {\n    const configInLocalStorage = localStorage.getItem('NIGHTINGALE_THEME');\n    if (configInLocalStorage && configInLocalStorage === 'dark') {\n      return configInLocalStorage;\n    }\n  } catch {}\n  return 'light';\n};\n\nconst createHandler = (theme: Theme = getDefaultTheme()): Handle => {\n  const browserConsoleFormatter = createBrowserConsoleFormatter(theme);\n  return <T extends Metadata>(record: LogRecord<T>) => {\n    consoleOutput(browserConsoleFormatter(record), record);\n  };\n};\n\ninterface BrowserConsoleHandlerOptions {\n  theme?: Theme;\n}\n\nexport class BrowserConsoleHandler implements Handler {\n  minLevel: Level = 0;\n\n  handle: Handle;\n\n  isHandling: IsHandling;\n\n  constructor(minLevel: Level, options: BrowserConsoleHandlerOptions = {}) {\n    this.isHandling = (level: Level, key: string) =>\n      level >= findDebugLevel(minLevel, key);\n\n    this.handle = createHandler(options.theme);\n  }\n}\n"],"names":["getDebugString","querystring","document","location","search","debugFromLocalStorage","window","localStorage","getItem","debugFromQueryString","decodeURI","replace","RegExp","findDebugLevel","minLevel","key","createFindDebugLevel","getDefaultTheme","configInLocalStorage","createHandler","theme","browserConsoleFormatter","createBrowserConsoleFormatter","record","consoleOutput","BrowserConsoleHandler","constructor","options","isHandling","level","handle"],"mappings":";;;;AAAO,SAASA,cAAT,GAAkC;AAAA,EAAA,IAAA,kBAAA,CAAA;;AACvC,EAAA,MAAMC,WAAW,GAAGC,CAAAA,kBAAAA,GAAAA,QAAQ,CAACC,QAAZ,MAAA,IAAA,IAAA,kBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAG,mBAAmBC,MAAvC,CAAA;AACA,EAAA,MAAMC,qBAAqB,GACxBC,MAAM,CAACC,YAAP,IAAuBA,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAxB,IAA0D,EAD5D,CAAA;;EAGA,IAAI,CAACP,WAAL,EAAkB;AAChB,IAAA,OAAOI,qBAAP,CAAA;AACD,GAPsC;;;AAUvC,EAAA,MAAMI,oBAAoB,GAAGC,SAAS,CACpCT,WAAW,CAACU,OAAZ;EAEE,IAAIC,MAAJ,CAAW,uCAAX,EAAoD,GAApD,CAFF,EAGE,IAHF,CADoC,CAAtC,CAAA;EAQA,OACE,CAACP,qBAAqB,GAAI,CAAA,EAAEA,qBAAsB,CAA5B,CAAA,CAAA,GAAiC,EAAvD,IACAI,oBAFF,CAAA;AAID;;ACRD,MAAMI,cAAc,GAAG,CAACC,QAAD,EAAkBC,GAAlB,KACrBC,oBAAoB,CAAChB,cAAc,EAAf,CAApB,CAAuCc,QAAvC,EAAiDC,GAAjD,CADF,CAAA;;AAKA,MAAME,eAAe,GAAG,MAAa;EACnC,IAAI;AACF,IAAA,MAAMC,oBAAoB,GAAGX,YAAY,CAACC,OAAb,CAAqB,mBAArB,CAA7B,CAAA;;AACA,IAAA,IAAIU,oBAAoB,IAAIA,oBAAoB,KAAK,MAArD,EAA6D;AAC3D,MAAA,OAAOA,oBAAP,CAAA;AACD,KAAA;GAJH,CAKE,MAAM,EAAE;;AACV,EAAA,OAAO,OAAP,CAAA;AACD,CARD,CAAA;;AAUA,MAAMC,aAAa,GAAG,CAACC,KAAY,GAAGH,eAAe,EAA/B,KAA8C;AAClE,EAAA,MAAMI,uBAAuB,GAAGC,6BAA6B,CAACF,KAAD,CAA7D,CAAA;AACA,EAAA,OAA4BG,MAArB,IAA8C;AACnDC,IAAAA,aAAa,CAACH,uBAAuB,CAACE,MAAD,CAAxB,EAAkCA,MAAlC,CAAb,CAAA;GADF,CAAA;AAGD,CALD,CAAA;;AAWO,MAAME,qBAAN,CAA+C;AACpDX,EAAAA,QAAQ,GAAU,CAAV,CAAA;;AAMRY,EAAAA,WAAW,CAACZ,QAAD,EAAkBa,OAAqC,GAAG,EAA1D,EAA8D;AACvE,IAAA,IAAA,CAAKC,UAAL,GAAkB,CAACC,KAAD,EAAed,GAAf,KAChBc,KAAK,IAAIhB,cAAc,CAACC,QAAD,EAAWC,GAAX,CADzB,CAAA;;AAGA,IAAA,IAAA,CAAKe,MAAL,GAAcX,aAAa,CAACQ,OAAO,CAACP,KAAT,CAA3B,CAAA;AACD,GAAA;;AAZmD;;;;"}