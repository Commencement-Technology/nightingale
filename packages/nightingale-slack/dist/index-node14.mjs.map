{"version":3,"file":"index-node14.mjs","sources":["../src/createBody.ts","../src/index.ts"],"sourcesContent":["/* eslint-disable camelcase */\nimport { Level } from 'nightingale-levels';\nimport markdownFormatter from 'nightingale-markdown-formatter';\nimport rawFormatter from 'nightingale-raw-formatter';\nimport type { LogRecord, Metadata } from 'nightingale-types';\nimport type { SlackConfig } from './SlackConfig';\n\nconst levelToSlackColor: Record<number, string> = {\n  [Level.TRACE]: '#808080',\n  [Level.DEBUG]: '#808080',\n  [Level.INFO]: '#808080',\n  [Level.WARN]: 'warning',\n  [Level.ERROR]: 'danger',\n  [Level.CRITICAL]: 'danger',\n  [Level.FATAL]: 'danger',\n  [Level.EMERGENCY]: 'danger',\n};\n\nexport default function createBody<T extends Metadata>(\n  record: LogRecord<T>,\n  slackConfig: SlackConfig,\n): Record<string, unknown> {\n  const markdown = markdownFormatter(record);\n  const raw = rawFormatter(record);\n\n  return {\n    channel: slackConfig.channel,\n    username: slackConfig.username,\n    icon_url: slackConfig.iconUrl,\n    icon_emoji: slackConfig.iconEmoji,\n    attachments: [\n      {\n        fallback: raw,\n        title: record.message,\n        color: levelToSlackColor[record.level],\n        text: markdown,\n        mrkdwn_in: ['text'],\n      },\n    ],\n  };\n}\n","import type {\n  LogRecord,\n  Handle,\n  Metadata,\n  Handler,\n  Level,\n} from 'nightingale-types';\nimport { post } from 'request';\nimport type { SlackConfig } from './SlackConfig';\nimport createBody from './createBody';\n\nexport type { SlackConfig } from './SlackConfig';\n\nexport { default as createBody } from './createBody';\n\nconst createHandler =\n  (slackConfig: SlackConfig) =>\n  <T extends Metadata>(record: LogRecord<T>) => {\n    const body = createBody(record, slackConfig);\n\n    post({ url: slackConfig.webhookUrl, body, json: true }).on(\n      'error',\n      (err2: Error) => {\n        console.error(err2.stack);\n      },\n    );\n  };\n\nexport class SlackHandler implements Handler {\n  minLevel: Level;\n\n  handle: Handle;\n\n  constructor(slackConfig: SlackConfig, minLevel: Level) {\n    this.minLevel = minLevel;\n    this.handle = createHandler(slackConfig);\n  }\n}\n"],"names":["levelToSlackColor","Level","TRACE","DEBUG","INFO","WARN","ERROR","CRITICAL","FATAL","EMERGENCY","createBody","record","slackConfig","markdown","markdownFormatter","raw","rawFormatter","channel","username","icon_url","iconUrl","icon_emoji","iconEmoji","attachments","fallback","title","message","color","level","text","mrkdwn_in","createHandler","body","post","url","webhookUrl","json","on","err2","console","error","stack","SlackHandler","constructor","minLevel","handle"],"mappings":";;;;;AAAA;AAOA,MAAMA,iBAAyC,GAAG;AAChD,EAAA,CAACC,KAAK,CAACC,KAAP,GAAe,SADiC;AAEhD,EAAA,CAACD,KAAK,CAACE,KAAP,GAAe,SAFiC;AAGhD,EAAA,CAACF,KAAK,CAACG,IAAP,GAAc,SAHkC;AAIhD,EAAA,CAACH,KAAK,CAACI,IAAP,GAAc,SAJkC;AAKhD,EAAA,CAACJ,KAAK,CAACK,KAAP,GAAe,QALiC;AAMhD,EAAA,CAACL,KAAK,CAACM,QAAP,GAAkB,QAN8B;AAOhD,EAAA,CAACN,KAAK,CAACO,KAAP,GAAe,QAPiC;EAQhD,CAACP,KAAK,CAACQ,SAAP,GAAmB,QAAA;AAR6B,CAAlD,CAAA;AAWe,SAASC,UAAT,CACbC,MADa,EAEbC,WAFa,EAGY;AACzB,EAAA,MAAMC,QAAQ,GAAGC,iBAAiB,CAACH,MAAD,CAAlC,CAAA;AACA,EAAA,MAAMI,GAAG,GAAGC,YAAY,CAACL,MAAD,CAAxB,CAAA;EAEA,OAAO;IACLM,OAAO,EAAEL,WAAW,CAACK,OADhB;IAELC,QAAQ,EAAEN,WAAW,CAACM,QAFjB;IAGLC,QAAQ,EAAEP,WAAW,CAACQ,OAHjB;IAILC,UAAU,EAAET,WAAW,CAACU,SAJnB;AAKLC,IAAAA,WAAW,EAAE,CACX;AACEC,MAAAA,QAAQ,EAAET,GADZ;MAEEU,KAAK,EAAEd,MAAM,CAACe,OAFhB;AAGEC,MAAAA,KAAK,EAAE3B,iBAAiB,CAACW,MAAM,CAACiB,KAAR,CAH1B;AAIEC,MAAAA,IAAI,EAAEhB,QAJR;MAKEiB,SAAS,EAAE,CAAC,MAAD,CAAA;KANF,CAAA;GALf,CAAA;AAeD;;ACzBD,MAAMC,aAAa,GAChBnB,WAAD,IACqBD,MAArB,IAA8C;AAC5C,EAAA,MAAMqB,IAAI,GAAGtB,UAAU,CAACC,MAAD,EAASC,WAAT,CAAvB,CAAA;AAEAqB,EAAAA,IAAI,CAAC;IAAEC,GAAG,EAAEtB,WAAW,CAACuB,UAAnB;IAA+BH,IAA/B;AAAqCI,IAAAA,IAAI,EAAE,IAAA;AAA3C,GAAD,CAAJ,CAAwDC,EAAxD,CACE,OADF,EAEGC,IAAD,IAAiB;AACfC,IAAAA,OAAO,CAACC,KAAR,CAAcF,IAAI,CAACG,KAAnB,CAAA,CAAA;GAHJ,CAAA,CAAA;AAMD,CAXH,CAAA;;AAaO,MAAMC,YAAN,CAAsC;AAK3CC,EAAAA,WAAW,CAAC/B,WAAD,EAA2BgC,QAA3B,EAA4C;IACrD,IAAKA,CAAAA,QAAL,GAAgBA,QAAhB,CAAA;AACA,IAAA,IAAA,CAAKC,MAAL,GAAcd,aAAa,CAACnB,WAAD,CAA3B,CAAA;AACD,GAAA;;AAR0C;;;;"}