{"version":3,"file":"index-browser-dev.cjs.js","sources":["../src/levelToStyles.ts","../src/levelToSymbol.ts","../src/styleToHexColor.ts","../src/styleToHtmlStyle.ts","../src/formatObject.ts","../src/formatRecordToString.ts"],"sourcesContent":["import Level from 'nightingale-levels';\n\nexport interface LevelToStyles {\n  readonly [level: number]: string[];\n}\n\nconst levelToStyles: LevelToStyles = {\n  [Level.TRACE]: ['gray'],\n  [Level.DEBUG]: ['gray'],\n  // [Level.INFO]: ['gray'],\n  [Level.WARN]: ['yellow'],\n  [Level.ERROR]: ['red', 'bold'],\n  [Level.CRITICAL]: ['red', 'bold'],\n  [Level.FATAL]: ['bgRed', 'white'],\n  [Level.EMERGENCY]: ['bgRed', 'white'],\n};\n\nexport default levelToStyles;\n","import Level from 'nightingale-levels';\n\nexport interface LevelToSymbol {\n  readonly [level: number]: string;\n}\n\nconst levelToSymbol: LevelToSymbol = {\n  [Level.TRACE]: '•',\n  [Level.DEBUG]: '•',\n  [Level.INFO]: '→',\n  [Level.WARN]: '⚠',\n  [Level.ERROR]: '✖',\n  [Level.CRITICAL]: '!',\n  [Level.FATAL]: '‼',\n  [Level.EMERGENCY]: '‼',\n};\n\nexport default levelToSymbol;\n","export interface StyleToHexColor {\n  readonly [key: string]: string;\n}\n\nconst styleToHexColor: StyleToHexColor = {\n  orange: 'ff5f00',\n  grayLight: '808080',\n  'gray-light': '808080',\n};\n\nexport default styleToHexColor;\n","import hexColors from './styleToHexColor';\n\nexport interface HtmlStyle {\n  readonly open: string;\n  readonly close: string;\n}\n\nexport interface StyleToHtmlStyle {\n  readonly [key: string]: HtmlStyle;\n}\n\nconst styleToHtmlStyle: StyleToHtmlStyle = {\n  // text style\n  bold: { open: 'font-weight: bold', close: 'font-weight: normal' },\n  italic: { open: 'font-style: italic', close: 'font-style: normal' },\n  underline: {\n    open: 'text-decoration: underline',\n    close: 'text-decoration: none',\n  },\n  inverse: {\n    open: 'unicode-bidi: bidi-override; direction: rtl',\n    close: 'unicode-bidi: normal; direction: ltr',\n  },\n  strikethrough: {\n    open: 'text-decoration: line-through',\n    close: 'text-decoration: none',\n  },\n\n  black: { open: 'color: black', close: 'color: initial' },\n  red: { open: 'color: #ff0020', close: 'color: initial' },\n  green: { open: 'color: #00b317', close: 'color: initial' },\n  yellow: { open: 'color: #ffcc00', close: 'color: initial' },\n  blue: { open: 'color: #00a0ff', close: 'color: initial' },\n  magenta: { open: 'color: #ff00a0', close: 'color: initial' },\n  cyan: { open: 'color: #00cfd8', close: 'color: initial' },\n  white: { open: 'color: white', close: 'color: initial' },\n  gray: { open: 'color: gray', close: 'color: initial' },\n\n  bgBlack: { open: 'background: black', close: 'background: initial' },\n  bgRed: { open: 'background: #ff0020', close: 'background: initial' },\n  bgGreen: { open: 'background: #00b317', close: 'background: initial' },\n  bgYellow: { open: 'background: #ffcc00', close: 'background: initial' },\n  bgBlue: { open: 'background: #00a0ff', close: 'background: initial' },\n  bgMagenta: { open: 'background: #ff00a0', close: 'background: initial' },\n  bgCyan: { open: 'background: #00cfd8', close: 'background: initial' },\n  bgWhite: { open: 'background: white', close: 'background: initial' },\n\n  orange: { open: `color: #${hexColors.orange}`, close: 'color: initial' },\n  grayLight: {\n    open: `color: #${hexColors.grayLight}`,\n    close: 'color: initial',\n  },\n  'gray-light': {\n    open: `color: #${hexColors.grayLight}`,\n    close: 'color: initial',\n  },\n};\n\nexport default styleToHtmlStyle;\n","/* eslint-disable max-lines, no-useless-concat, prefer-template, no-use-before-define, @typescript-eslint/no-use-before-define */\nimport { Styles } from 'nightingale-types';\n\nexport interface FormatObjectOptions {\n  padding?: string;\n  maxDepth?: number;\n}\n\nexport type StyleFn = (styles: Styles, value: string) => string;\n\nexport interface ObjectStyles {\n  [key: string]: Styles;\n}\n\nconst noStyleFn: StyleFn = (styles: Styles, value: string): string => value;\n\ninterface InternalFormatParams {\n  padding: string;\n  depth: number;\n  maxDepth: number;\n  objects: Set<any>;\n}\n\ninterface FormattedKey {\n  stringKey: string;\n  formattedKey: string;\n}\n\ntype FormatKey = (\n  key: string,\n  styleFn: StyleFn,\n  internalFormatParams: InternalFormatParams,\n) => FormattedKey;\n\ninterface Value {\n  key: any;\n  value: any;\n}\n\ninterface FormattedValue {\n  stringValue: string;\n  formattedValue: string;\n}\n\ntype Values = Value[];\n\ninterface InternalFormatIteratorParams {\n  prefix: string;\n  suffix: string;\n  prefixSuffixSpace?: string;\n  formatKey?: FormatKey;\n}\n\nfunction tryStringify(arg: any) {\n  try {\n    return JSON.stringify(arg).replace(/\\\\n/g, '\\n');\n  } catch (_) {\n    return '[Circular]';\n  }\n}\n\nconst sameRawFormattedValue = (value: string) => ({\n  stringValue: value,\n  formattedValue: value,\n});\n\nfunction internalFormatValue(\n  value: any,\n  styleFn: StyleFn,\n  styles: Styles,\n  { padding, depth, maxDepth, objects }: InternalFormatParams,\n) {\n  const typeofValue = typeof value;\n\n  if (!styles) {\n    if (value == null) {\n      styles = ['cyan'];\n    } else {\n      switch (typeofValue) {\n        case 'boolean':\n          styles = ['green'];\n          break;\n        case 'number':\n          styles = ['yellow'];\n          break;\n        case 'string':\n          styles = ['orange'];\n          break;\n        case 'symbol':\n          styles = ['magenta'];\n          break;\n      }\n    }\n  }\n\n  let stringValue;\n  if (value === null) {\n    stringValue = 'null';\n  } else if (value === undefined) {\n    stringValue = 'undefined';\n  } else if (typeofValue === 'boolean') {\n    stringValue = value.toString();\n  } else if (value.constructor === Object) {\n    if (depth >= maxDepth) {\n      stringValue = '{Object...}';\n    } else {\n      return internalFormatObject(value, styleFn, undefined, {\n        padding,\n        depth: depth + 1,\n        maxDepth,\n        objects,\n      });\n    }\n  } else if (Array.isArray(value)) {\n    if (depth >= maxDepth) {\n      stringValue = '[Array...]';\n    } else {\n      return internalFormatArray(value, styleFn, {\n        padding,\n        depth: depth + 1,\n        maxDepth,\n        objects,\n      });\n    }\n  } else if (value instanceof Error) {\n    const stack = value.stack;\n    stringValue =\n      stack && stack.startsWith(value.message)\n        ? stack\n        : `${value.message}\\n${stack}`;\n  } else if (value instanceof Map) {\n    const name = value.constructor.name;\n    if (depth >= maxDepth) {\n      stringValue = `{${name}...}`;\n    } else {\n      return internalFormatMap(name, value, styleFn, {\n        padding,\n        depth: depth + 1,\n        maxDepth,\n        objects,\n      });\n    }\n  } else if (value instanceof Set) {\n    const name = value.constructor.name;\n    if (depth >= maxDepth) {\n      stringValue = `{${name}...}`;\n    } else {\n      return internalFormatSet(name, value, styleFn, {\n        padding,\n        depth: depth + 1,\n        maxDepth,\n        objects,\n      });\n    }\n  } else if (value instanceof WeakMap) {\n    stringValue = '{WeakMap...}';\n  } else if (value instanceof WeakSet) {\n    stringValue = '{WeakSet...}';\n  } else {\n    stringValue = tryStringify(value);\n  }\n\n  const formattedValue = styleFn(styles, stringValue);\n\n  return {\n    stringValue,\n    formattedValue,\n  };\n}\n\nconst separator = ',';\n\nconst internalFormatKey: FormatKey = (\n  key: string,\n  styleFn: StyleFn,\n  internalFormatParams: InternalFormatParams,\n): FormattedKey => {\n  if (!key) return { stringKey: '', formattedKey: '' };\n  return {\n    stringKey: `${key}: `,\n    formattedKey: styleFn(['gray-light', 'bold'], `${key}:`) + ' ',\n  };\n};\n\nconst internalFormatMapKey: FormatKey = (\n  key: string,\n  styleFn: StyleFn,\n  internalFormatParams: InternalFormatParams,\n): FormattedKey => {\n  const { stringValue, formattedValue } = internalFormatValue(\n    key,\n    noStyleFn,\n    undefined,\n    internalFormatParams,\n  );\n  return {\n    stringKey: stringValue + ' => ',\n    formattedKey: styleFn(['gray-light', 'bold'], `${formattedValue}:`) + ' ',\n  };\n};\n\nconst internalFormatIterator = (\n  values: Values,\n  styleFn: StyleFn,\n  objectStyles: ObjectStyles | undefined,\n  { padding, depth, maxDepth, objects }: InternalFormatParams,\n  {\n    prefix,\n    suffix,\n    prefixSuffixSpace = ' ',\n    formatKey = internalFormatKey,\n  }: InternalFormatIteratorParams,\n) => {\n  let breakLine = false;\n  const formattedSeparator = () => styleFn(['gray'], separator);\n\n  const valuesMaxIndex = values.length - 1;\n  const formattedValues: FormattedValue[] = values.map(\n    ({ key, value }, index: number) => {\n      const nextDepth = depth + 1;\n      const internalFormatParams = {\n        padding,\n        depth: nextDepth,\n        maxDepth,\n        objects,\n      };\n\n      // key must be formatted before value (browser-formatter needs order)\n      const { stringKey, formattedKey } = formatKey(\n        key,\n        styleFn,\n        internalFormatParams,\n      );\n\n      let { stringValue, formattedValue } = internalFormatValue(\n        value,\n        styleFn,\n        key && objectStyles && objectStyles[key],\n        internalFormatParams,\n      );\n\n      if (\n        stringValue &&\n        (stringValue.length > 80 || stringValue.indexOf('\\n') !== -1)\n      ) {\n        breakLine = true;\n        stringValue = stringValue.replace(/\\n/g, `\\n${padding}`);\n        formattedValue = formattedValue.replace(/\\n/g, `\\n${padding}`);\n      }\n\n      return {\n        stringValue:\n          stringKey + stringValue + (index === valuesMaxIndex ? '' : separator),\n        // eslint-disable-next-line no-useless-concat\n        formattedValue:\n          formattedKey +\n          formattedValue +\n          (index === valuesMaxIndex ? '' : formattedSeparator()),\n        // note: we need to format the separator for each values for browser-formatter\n      };\n    },\n  );\n\n  return {\n    stringValue:\n      prefix +\n      formattedValues\n        .map(\n          breakLine\n            ? (v) => `\\n${padding}${v.stringValue}`\n            : (fv) => fv.stringValue,\n        )\n        .join(breakLine ? '\\n' : ' ') +\n      suffix,\n    // eslint-disable-next-line prefer-template\n    formattedValue:\n      `${prefix}${breakLine ? '' : prefixSuffixSpace}` +\n      formattedValues\n        .map(\n          breakLine\n            ? (v) => `\\n${padding}${v.formattedValue}`\n            : (v) => v.formattedValue,\n        )\n        .join(breakLine ? '' : ' ') +\n      `${breakLine ? ',\\n' : prefixSuffixSpace}${suffix}`,\n  };\n};\n\nfunction internalFormatObject(\n  object: { [key: string]: any },\n  styleFn: StyleFn,\n  objectStyles: ObjectStyles | undefined,\n  { padding, depth, maxDepth, objects }: InternalFormatParams,\n) {\n  if (objects.has(object)) {\n    return sameRawFormattedValue('{Circular Object}');\n  }\n\n  const keys: string[] = Object.keys(object);\n  if (keys.length === 0) {\n    return sameRawFormattedValue('{}');\n  }\n\n  objects.add(object);\n\n  const result = internalFormatIterator(\n    keys.map((key) => ({ key, value: object[key] })),\n    styleFn,\n    objectStyles,\n    { padding, depth, maxDepth, objects },\n    { prefix: '{', suffix: '}' },\n  );\n\n  objects.delete(object);\n\n  return result;\n}\n\nfunction internalFormatMap(\n  name: string,\n  map: Map<any, any>,\n  styleFn: StyleFn,\n  { padding, depth, maxDepth, objects }: InternalFormatParams,\n) {\n  if (objects.has(map)) {\n    return sameRawFormattedValue(`{Circular ${name}}`);\n  }\n\n  const keys = [...map.keys()];\n  if (keys.length === 0) {\n    return sameRawFormattedValue(`${name} {}`);\n  }\n\n  objects.add(map);\n\n  const result = internalFormatIterator(\n    keys.map((key) => ({ key, value: map.get(key) })),\n    styleFn,\n    undefined,\n    { padding, depth, maxDepth, objects },\n    { prefix: `${name} {`, suffix: '}', formatKey: internalFormatMapKey },\n  );\n\n  objects.delete(map);\n\n  return result;\n}\n\nfunction internalFormatArray(\n  array: any[],\n  styleFn: StyleFn,\n  { padding, depth, maxDepth, objects }: InternalFormatParams,\n) {\n  if (objects.has(array)) {\n    return sameRawFormattedValue('{Circular Array}');\n  }\n\n  if (array.length === 0) {\n    return sameRawFormattedValue('[]');\n  }\n\n  objects.add(array);\n\n  const result = internalFormatIterator(\n    array.map((value: any) => ({ key: undefined, value })),\n    styleFn,\n    undefined,\n    { padding, depth, maxDepth, objects },\n    { prefix: '[', suffix: ']', prefixSuffixSpace: '' },\n  );\n\n  objects.delete(array);\n\n  return result;\n}\n\nfunction internalFormatSet(\n  name: string,\n  set: Set<any>,\n  styleFn: StyleFn,\n  { padding, depth, maxDepth, objects }: InternalFormatParams,\n) {\n  if (objects.has(set)) {\n    return sameRawFormattedValue(`{Circular ${name}}`);\n  }\n\n  const values = [...set.values()];\n  if (values.length === 0) {\n    return sameRawFormattedValue(`${name} []`);\n  }\n\n  objects.add(set);\n\n  const result = internalFormatIterator(\n    values.map((value) => ({ key: undefined, value })),\n    styleFn,\n    undefined,\n    { padding, depth, maxDepth, objects },\n    { prefix: `${name} [`, suffix: ']' },\n  );\n\n  objects.delete(set);\n\n  return result;\n}\n\nexport default function formatObject(\n  object: { [key: string]: any },\n  styleFn: StyleFn = noStyleFn,\n  objectStyles?: ObjectStyles,\n  { padding = '  ', maxDepth = 10 }: FormatObjectOptions = {},\n) {\n  const { formattedValue: result } = internalFormatObject(\n    object,\n    styleFn,\n    objectStyles,\n    {\n      padding,\n      maxDepth,\n      depth: 0,\n      objects: new Set(),\n    },\n  );\n\n  if (result === '{}') {\n    return '';\n  }\n\n  return result;\n}\n","/* eslint-disable no-unused-vars */\nimport { LogRecord, Metadata } from 'nightingale-types';\nimport levelToSymbol from './levelToSymbol';\nimport levelToStyles from './levelToStyles';\nimport formatObject, { StyleFn, ObjectStyles } from './formatObject';\n\nexport default function formatRecordToString<T extends Metadata>(\n  record: LogRecord<T>,\n  style: StyleFn,\n) {\n  const parts: string[] = [];\n\n  if (record.displayName) {\n    parts.push(style(['gray-light'], record.displayName));\n  } else if (record.key) {\n    parts.push(style(['gray-light'], record.key));\n  }\n\n  if (record.datetime) {\n    parts.push(\n      style(['gray', 'bold'], record.datetime.toTimeString().split(' ')[0]),\n    );\n    /* new Date().toFormat('HH24:MI:SS') */\n  }\n\n  let message: string = record.symbol || levelToSymbol[record.level];\n  const styles = record.styles || levelToStyles[record.level];\n\n  if (record.message) {\n    if (message) {\n      message += ` ${record.message}`;\n    } else {\n      message = record.message;\n    }\n  }\n\n  if (message) {\n    if (styles) {\n      message = style(styles, message);\n    }\n    parts.push(message);\n  }\n\n  const formatRecordObject = (\n    key: string,\n    object: object | undefined,\n    styles: ObjectStyles | undefined,\n  ) => {\n    if (!object) {\n      return;\n    }\n\n    const stringObject = formatObject(object, style, styles);\n\n    if (!stringObject) {\n      return;\n    }\n\n    parts.push(stringObject);\n  };\n\n  formatRecordObject('metadata', record.metadata, record.metadataStyles);\n  formatRecordObject('extra', record.extra, undefined);\n  formatRecordObject('context', record.context, undefined);\n\n  return parts.join(' ');\n}\n"],"names":["levelToStyles","Level","TRACE","DEBUG","WARN","ERROR","CRITICAL","FATAL","EMERGENCY","levelToSymbol","INFO","styleToHexColor","orange","grayLight","styleToHtmlStyle","bold","open","close","italic","underline","inverse","strikethrough","black","red","green","yellow","blue","magenta","cyan","white","gray","bgBlack","bgRed","bgGreen","bgYellow","bgBlue","bgMagenta","bgCyan","bgWhite","hexColors","noStyleFn","styles","value","tryStringify","arg","JSON","stringify","replace","_","sameRawFormattedValue","stringValue","formattedValue","internalFormatValue","styleFn","padding","depth","maxDepth","objects","typeofValue","undefined","toString","constructor","Object","internalFormatObject","Array","isArray","internalFormatArray","Error","stack","startsWith","message","Map","name","internalFormatMap","Set","internalFormatSet","WeakMap","WeakSet","separator","internalFormatKey","key","stringKey","formattedKey","internalFormatMapKey","internalFormatParams","internalFormatIterator","values","objectStyles","prefix","suffix","prefixSuffixSpace","formatKey","breakLine","formattedSeparator","valuesMaxIndex","length","formattedValues","map","index","indexOf","v","fv","join","object","has","keys","add","result","delete","get","array","set","formatObject","formatRecordToString","record","style","parts","displayName","push","datetime","toTimeString","split","symbol","level","formatRecordObject","stringObject","metadata","metadataStyles","extra","context"],"mappings":"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"}